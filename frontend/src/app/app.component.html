<div class="app-container">
  <!-- Toast Notifications -->
  <app-toast></app-toast>

  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" 
       *ngIf="isLoggedIn && showNavigation && isMobileMenuOpen"
       (click)="closeMobileMenu()"
       [class.active]="isMobileMenuOpen">
  </div>

  <!-- Left Sidebar Navigation -->
  <aside class="sidebar" 
         *ngIf="isLoggedIn && showNavigation" 
         [class.collapsed]="isSidebarCollapsed"
         [class.show]="isMobileMenuOpen">
    <!-- Brand Header -->
    <div class="sidebar-header">
      <a [routerLink]="isRoot ? '/root/dashboard' : '/dashboard'" class="brand-link">
        <!-- Organization Logo for non-ROOT users -->
        <img *ngIf="!isRoot && organizationLogoUrl"
             [src]="organizationLogoUrl"
             alt="Organization Logo"
             class="org-logo"
             (error)="organizationLogoUrl = ''">
        <span *ngIf="!isRoot && !organizationLogoUrl" class="brand-icon">ğŸ‘¥</span>
        <!-- ROOT Icon -->
        <span *ngIf="isRoot" class="brand-icon">ğŸ‘‘</span>
        <span class="brand-text" *ngIf="!isSidebarCollapsed">
          {{ isRoot ? 'ROOT' : (organizationName || 'EMS') }}
        </span>
      </a>
    </div>

    <!-- Navigation Menu -->
    <nav class="sidebar-nav">
      <!-- MAIN Section -->
      <div class="nav-section" *ngIf="!isSidebarCollapsed">
        <div class="nav-section-title">MAIN</div>
      </div>
      
      <!-- Dashboard -->
      <a *ngIf="!isRoot && !isAdmin" routerLink="/dashboard" routerLinkActive="active" class="nav-item" [title]="'Dashboard'">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Dashboard</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>

      <!-- Employees (for ADMIN) -->
      <a *ngIf="!isRoot && isAdmin" routerLink="/employees" routerLinkActive="active" class="nav-item" [title]="'Employees'">
        <span class="nav-icon">ğŸ‘¥</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Employees</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>

      <!-- Organizations (for ROOT) -->
      <a *ngIf="isRoot" routerLink="/root/dashboard" routerLinkActive="active" class="nav-item" [title]="'Organizations'">
        <span class="nav-icon">ğŸ¢</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Organizations</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>

      <!-- Attendance only for ADMIN and USER, not SUPER_ADMIN -->
      <a *ngIf="!isRoot && !isSuperAdmin" routerLink="/attendance" routerLinkActive="active" class="nav-item" [title]="'Attendance'">
        <span class="nav-icon">ğŸ“</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Attendance</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>

      <!-- PAGES Section -->
      <div class="nav-section" *ngIf="!isSidebarCollapsed && !isRoot">
        <div class="nav-section-title">PAGES</div>
      </div>

      <a *ngIf="!isRoot" routerLink="/rota" routerLinkActive="active" class="nav-item" [title]="'ROTA'">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">ROTA</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>
      <a *ngIf="!isRoot" routerLink="/documents" routerLinkActive="active" class="nav-item" [title]="'Documents'">
        <span class="nav-icon">ğŸ“„</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Documents</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>
      <a *ngIf="!isRoot" routerLink="/leaves" routerLinkActive="active" class="nav-item" [title]="'Leaves'">
        <span class="nav-icon">ğŸ–ï¸</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Leaves</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>
      <!-- Alert Configuration only for SUPER_ADMIN -->
      <a *ngIf="isSuperAdmin" routerLink="/alert-configuration" routerLinkActive="active" class="nav-item" [title]="'Alert Config'">
        <span class="nav-icon">ğŸ“§</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">Alert Config</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>
      <!-- SMTP Configuration only for SUPER_ADMIN -->
      <a *ngIf="isSuperAdmin" routerLink="/smtp-configuration" routerLinkActive="active" class="nav-item" [title]="'SMTP Settings'">
        <span class="nav-icon">ğŸ“®</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed">SMTP Settings</span>
        <span class="nav-arrow" *ngIf="!isSidebarCollapsed">â€º</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <div class="main-wrapper" [class.with-sidebar]="isLoggedIn && showNavigation" [class.sidebar-collapsed]="isSidebarCollapsed">
    <!-- Top Header Bar -->
    <header class="top-header" *ngIf="isLoggedIn && showNavigation">
      <div class="header-left">
        <button class="header-menu-toggle" 
                (click)="toggleMobileMenu()" 
                title="Toggle Menu"
                [attr.aria-label]="'Toggle Menu'"
                [attr.aria-expanded]="isMobileMenuOpen">
          <span class="hamburger-icon">â˜°</span>
        </button>
      </div>

      <!-- Search Bar (Only for ADMIN and SUPER_ADMIN) -->
      <div class="header-search" *ngIf="isAdmin && !isRoot">
        <app-global-search></app-global-search>
      </div>

      <div class="header-right">
        <!-- Notifications (Only for non-ROOT users) -->
        <div class="header-icon-wrapper" *ngIf="!isRoot">
          <app-notification-dropdown></app-notification-dropdown>
        </div>

        <!-- User Profile -->
        <div class="header-user-profile">
          <div class="user-avatar-small">
            <span>{{ userName.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="user-info-small">
            <div class="user-name-small">{{ userName }}</div>
            <div class="user-role-small">
              <span *ngIf="isRoot">ğŸ‘‘ ROOT</span>
              <span *ngIf="!isRoot && isAdmin">Admin</span>
              <span *ngIf="!isRoot && !isAdmin">User</span>
            </div>
          </div>
          <button class="header-logout" (click)="logout()" title="Logout">
            <span class="logout-text">Logout</span>
            <span class="logout-icon">ğŸšª</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" [class.with-header]="isLoggedIn && showNavigation" [class.full-screen]="!showNavigation">
      <router-outlet></router-outlet>
    </main>
  </div>

  <!-- PWA Install Prompt -->
  <app-pwa-install></app-pwa-install>
</div>

