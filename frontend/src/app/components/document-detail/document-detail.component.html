<div class="document-detail-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading document details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message">
    <i class="error-icon">‚ö†Ô∏è</i>
    <p>{{ error }}</p>
    <button (click)="goBack()" class="btn-secondary">Go Back</button>
  </div>

  <!-- Document Details -->
  <div *ngIf="document && !loading" class="document-details">
    <!-- Header -->
    <div class="detail-header">
      <div class="header-left">
        <button (click)="goBack()" class="btn-back">
          <span>‚Üê</span> Back to Documents
        </button>
        <h2>{{ getDocumentTypeLabel(document.documentType) }} Details</h2>
      </div>
      <div class="header-actions">
        <button *ngIf="(document.documentType === 'PASSPORT' || document.documentType === 'VISA') && !editMode && isDataIncomplete()" (click)="enableEditMode()" class="btn-edit">
          <span>‚úèÔ∏è</span> Complete Missing Data
        </button>
        <button *ngIf="(document.documentType === 'PASSPORT' || document.documentType === 'VISA') && !editMode && !isDataIncomplete()" (click)="enableEditMode()" class="btn-edit">
          <span>‚úèÔ∏è</span> Edit
        </button>
        <button (click)="deleteDocument()" class="btn-delete">
          <span>üóëÔ∏è</span> Delete
        </button>
      </div>
    </div>

    <!-- OCR Failure Alert - Only for PASSPORT and VISA -->
    <div *ngIf="(document.documentType === 'PASSPORT' || document.documentType === 'VISA') && isDataIncomplete()" class="alert alert-warning">
      <div class="alert-header">
        <span class="alert-icon">‚ö†Ô∏è</span>
        <strong>OCR Extraction Incomplete</strong>
      </div>
      <p>The automatic text extraction was unable to read all fields from your document.</p>
      <p><strong>Missing information:</strong> {{ getMissingFields().join(', ') }}</p>
      <div class="alert-suggestion">
        <p><strong>üìù Suggestions for better OCR results:</strong></p>
        <ul>
          <li>Ensure the document image is clear and well-lit</li>
          <li>Make sure the document is not rotated (text should be horizontal)</li>
          <li>Avoid glare or shadows on the document</li>
          <li>Use a higher resolution image (300 DPI or higher)</li>
          <li>Re-scan or re-photograph the document if possible</li>
        </ul>
        <p class="manual-entry-prompt">
          <strong>You can manually enter the missing information below.</strong>
          <span *ngIf="!editMode">Click "Complete Missing Data" button above to enter details.</span>
        </p>
      </div>
    </div>

    <!-- Success Message -->
    <div *ngIf="saveSuccess" class="alert alert-success">
      <span class="alert-icon">‚úì</span>
      Document information updated successfully!
    </div>

    <!-- Error Message -->
    <div *ngIf="saveError" class="alert alert-error">
      <span class="alert-icon">‚úó</span>
      {{ saveError }}
    </div>

    <!-- Expiry Status Badge - Only for PASSPORT and VISA -->
    <div *ngIf="shouldShowExpiryBadge(document)" class="expiry-badge" [ngClass]="'badge-' + getExpiryStatus(document.daysUntilExpiry)">
      <span class="badge-icon">
        {{ document.daysUntilExpiry && document.daysUntilExpiry < 0 ? '‚ùå' :
           document.daysUntilExpiry && document.daysUntilExpiry <= 30 ? '‚ö†Ô∏è' :
           document.daysUntilExpiry && document.daysUntilExpiry <= 90 ? '‚è∞' : '‚úÖ' }}
      </span>
      {{ getExpiryStatusText(document.daysUntilExpiry) }}
    </div>

    <!-- Document Information Grid - Not for RESUME and SHARE_CODE -->
    <div *ngIf="!isSupportingDocument(document.documentType)" class="info-grid">
      <!-- Employee Information -->
      <div class="info-section">
        <h3><span class="section-icon">üë§</span> Employee Information</h3>
        <div class="info-item">
          <label>Employee Name:</label>
          <span class="value">{{ document.employeeName || 'Not available' }}</span>
        </div>
        <div class="info-item">
          <label>Employee ID:</label>
          <span class="value">{{ document.employeeId || 'Not available' }}</span>
        </div>
      </div>

      <!-- Document Information -->
      <div class="info-section">
        <h3><span class="section-icon">üìÑ</span> Document Information</h3>

        <!-- Document Number - Only for identity documents -->
        <div class="info-item" *ngIf="shouldShowIdentityFields(document)" [ngClass]="{'missing-data': !document.documentNumber}">
          <label>Document Number: <span class="required">*</span></label>
          <span *ngIf="!editMode" class="value">
            {{ document.documentNumber || '‚ùå Not extracted' }}
          </span>
          <input *ngIf="editMode"
                 type="text"
                 [(ngModel)]="manualDocumentNumber"
                 placeholder="Enter document number"
                 class="form-control"
                 required>
        </div>

        <div class="info-item">
          <label>Document Type:</label>
          <span class="value badge-type">{{ getDocumentTypeLabel(document.documentType) }}</span>
        </div>

        <!-- VISA Type - Only for VISA documents -->
        <div class="info-item" *ngIf="document.documentType === 'VISA'">
          <label>Visa Type:</label>
          <span *ngIf="!editMode" class="value highlight">{{ document.visaType || 'Not specified' }}</span>
          <select *ngIf="editMode"
                  [(ngModel)]="manualVisaType"
                  class="form-control">
            <option value="">Select Visa Type</option>
            <option *ngFor="let visa of visaTypeOptions" [value]="visa">
              {{ visa }}
            </option>
          </select>
        </div>

        <!-- CONTRACT specific fields -->
        <div class="info-item" *ngIf="document.documentType === 'CONTRACT' && document.contractDate">
          <label>üìÖ Date of Employment:</label>
          <span class="value highlight">{{ formatDate(document.contractDate) }}</span>
        </div>

        <div class="info-item" *ngIf="document.documentType === 'CONTRACT' && document.jobTitleContract">
          <label>üíº Job Title:</label>
          <span class="value">{{ document.jobTitleContract }}</span>
        </div>

        <div class="info-item" *ngIf="document.documentType === 'CONTRACT' && document.placeOfWork">
          <label>üìç Place of Work:</label>
          <span class="value">{{ document.placeOfWork }}</span>
        </div>

        <div class="info-item" *ngIf="document.documentType === 'CONTRACT' && document.contractBetween">
          <label>üìù Contract Between:</label>
          <span class="value">{{ document.contractBetween }}</span>
        </div>

        <!-- Issuing Country - Only for PASSPORT and VISA -->
        <div class="info-item" *ngIf="document.documentType === 'PASSPORT' || document.documentType === 'VISA'" [ngClass]="{'missing-data': !document.issuingCountry}">
          <label>Issuing Country: <span class="required">*</span></label>
          <span *ngIf="!editMode" class="value">
            {{ document.issuingCountry || '‚ùå Not extracted' }}
          </span>
          <input *ngIf="editMode"
                 type="text"
                 [(ngModel)]="manualIssuingCountry"
                 placeholder="Enter issuing country"
                 class="form-control"
                 required>
        </div>

        <div class="info-item" *ngIf="document.nationality">
          <label>Nationality:</label>
          <span class="value">{{ document.nationality || 'Not available' }}</span>
        </div>
      </div>

      <!-- Personal Information -->
      <div class="info-section" *ngIf="document.fullName || document.dateOfBirth">
        <h3><span class="section-icon">‚ÑπÔ∏è</span> Personal Information</h3>

        <div class="info-item" *ngIf="document.fullName">
          <label>Full Name:</label>
          <span class="value">{{ document.fullName }}</span>
        </div>

        <div class="info-item" *ngIf="document.dateOfBirth">
          <label>Date of Birth:</label>
          <span class="value">{{ formatDate(document.dateOfBirth) }}</span>
        </div>
      </div>

      <!-- Date Information - Only for PASSPORT and VISA -->
      <div class="info-section" *ngIf="shouldShowImportantDates(document)">
        <h3><span class="section-icon">üìÖ</span> Important Dates</h3>

        <div class="info-item" [ngClass]="{'missing-data': !document.issueDate}">
          <label>Issue Date:</label>
          <span *ngIf="!editMode" class="value">
            {{ document.issueDate ? formatDate(document.issueDate) : '‚ùå Not extracted' }}
          </span>
          <input *ngIf="editMode"
                 type="date"
                 [(ngModel)]="manualIssueDate"
                 class="form-control"
                 [max]="maxDate">
        </div>

        <div class="info-item" [ngClass]="{'missing-data': !document.expiryDate}">
          <label>Expiry Date: <span class="required">*</span></label>
          <span *ngIf="!editMode" class="value"
                [ngClass]="{'expired': document.daysUntilExpiry && document.daysUntilExpiry < 0}">
            {{ document.expiryDate ? formatDate(document.expiryDate) : '‚ùå Not extracted' }}
          </span>
          <input *ngIf="editMode"
                 type="date"
                 [(ngModel)]="manualExpiryDate"
                 class="form-control"
                 required>
        </div>

        <div class="info-item" *ngIf="document.daysUntilExpiry">
          <label>Days Until Expiry:</label>
          <span class="value days-count" [ngClass]="getExpiryStatus(document.daysUntilExpiry)">
            {{ document.daysUntilExpiry }} days
          </span>
        </div>

        <div class="info-item">
          <label>Upload Date:</label>
          <span class="value">{{ formatDate(document.uploadedDate) }}</span>
        </div>
      </div>

      <!-- Upload Date for CONTRACT documents -->
      <div class="info-section" *ngIf="document.documentType === 'CONTRACT'">
        <h3><span class="section-icon">üìÖ</span> Important Dates</h3>

        <div class="info-item" *ngIf="document.contractDate">
          <label>Date of Employment (Contract Date):</label>
          <span class="value highlight">{{ formatDate(document.contractDate) }}</span>
        </div>

        <div class="info-item">
          <label>Upload Date:</label>
          <span class="value">{{ formatDate(document.uploadedDate) }}</span>
        </div>
      </div>

      <!-- Upload Information for RESUME and SHARE_CODE -->
      <div class="info-section" *ngIf="isSupportingDocument(document.documentType)">
        <h3><span class="section-icon">üìÖ</span> Upload Information</h3>

        <div class="info-item">
          <label>Upload Date:</label>
          <span class="value">{{ formatDate(document.uploadedDate) }}</span>
        </div>
      </div>

      <!-- File Information -->
      <div class="info-section">
        <h3><span class="section-icon">üìé</span> File Information</h3>

        <div class="info-item">
          <label>File Name:</label>
          <span class="value">{{ document.fileName || 'Not available' }}</span>
        </div>

        <div class="info-item">
          <label>File Type:</label>
          <span class="value">{{ document.fileType || 'Not available' }}</span>
        </div>
      </div>

      <!-- Alert Information -->
      <div class="info-section" *ngIf="document.alertSentCount || document.lastAlertSent">
        <h3><span class="section-icon">üîî</span> Alert History</h3>

        <div class="info-item" *ngIf="document.alertSentCount">
          <label>Alerts Sent:</label>
          <span class="value">{{ document.alertSentCount }} time(s)</span>
        </div>

        <div class="info-item" *ngIf="document.lastAlertSent">
          <label>Last Alert:</label>
          <span class="value">{{ formatDate(document.lastAlertSent) }}</span>
        </div>
      </div>
    </div>

    <!-- Document Preview -->
    <div class="document-preview">
      <!-- CONTRACT and supporting documents (PDF): Show PDF viewer -->
      <div *ngIf="documentImageUrl && isPdfDocument && (document.documentType === 'CONTRACT' || isSupportingDocument(document.documentType))">
        <h3><span class="section-icon">üìÑ</span>
          {{ getDocumentTypeLabel(document.documentType) }} Document
        </h3>

        <!-- Loading State -->
        <div *ngIf="imageLoading" class="image-loading">
          <div class="spinner"></div>
          <p>Loading document...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="imageError && !imageLoading" class="image-error">
          <span class="error-icon">‚ö†Ô∏è</span>
          <p>Unable to load document</p>
        </div>

        <!-- PDF Viewer -->
        <div *ngIf="documentImageUrl && !imageLoading && !imageError" class="pdf-container">
          <object [data]="documentImageUrl"
                  type="application/pdf"
                  class="pdf-viewer">
            <div class="pdf-fallback">
              <p>‚ö†Ô∏è Your browser cannot display PDF files inline.</p>
              <p>Please use one of the options below:</p>
              <div class="fallback-actions">
                <button (click)="openPdfInNewTab()" class="btn-primary">
                  <span>üîó</span> Open PDF in New Tab
                </button>
                <button (click)="downloadDocument()" class="btn-download">
                  <span>‚¨áÔ∏è</span> Download {{ getDocumentTypeLabel(document.documentType) }} PDF
                </button>
              </div>
            </div>
          </object>
          <div class="image-actions">
            <button (click)="openPdfInNewTab()" class="btn-primary">
              <span>üîó</span> Open in New Tab
            </button>
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download {{ getDocumentTypeLabel(document.documentType) }}
            </button>
          </div>
        </div>
      </div>

      <!-- RESUME (DOCX) documents: Show download option -->
      <div *ngIf="document.documentType === 'RESUME' && !isFilePdf()">
        <h3><span class="section-icon">üìÑ</span> {{ getDocumentTypeLabel(document.documentType) }} (DOCX)</h3>

        <div class="docx-container">
          <div class="docx-info">
            <span class="file-icon">üìù</span>
            <div class="file-details">
              <p class="file-name">{{ document.fileName }}</p>
              <p class="file-type">Microsoft Word Document</p>
            </div>
          </div>
          <p class="docx-message">Word documents cannot be previewed in the browser.</p>
          <div class="image-actions">
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download {{ getDocumentTypeLabel(document.documentType) }}
            </button>
          </div>
        </div>
      </div>

      <!-- Supporting documents (images): show image viewer -->
      <div *ngIf="isImageDocument && isSupportingDocument(document.documentType)">
        <h3><span class="section-icon">üñºÔ∏è</span> {{ getDocumentTypeLabel(document.documentType) }} Preview</h3>

        <div *ngIf="imageLoading" class="image-loading">
          <div class="spinner"></div>
          <p>Loading document...</p>
        </div>

        <div *ngIf="imageError && !imageLoading" class="image-error">
          <span class="error-icon">‚ö†Ô∏è</span>
          <p>Unable to load document</p>
          <div class="fallback-actions">
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download Document
            </button>
          </div>
        </div>

        <div *ngIf="!imageLoading && !imageError" class="image-container">
          <img [src]="documentImageRawUrl"
               [alt]="document.fileName"
               class="document-image"
               (error)="onImageError()">
          <div class="image-actions">
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download Original
            </button>
          </div>
        </div>
      </div>

      <!-- PASSPORT/VISA documents: Smart Viewer (Image or PDF based on actual file type) -->
      <div *ngIf="document.documentType === 'PASSPORT' || document.documentType === 'VISA'">
        <h3><span class="section-icon">üñºÔ∏è</span> Document Preview</h3>

        <!-- Loading State -->
        <div *ngIf="imageLoading" class="image-loading">
          <div class="spinner"></div>
          <p>Loading document...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="imageError && !imageLoading" class="image-error">
          <span class="error-icon">‚ö†Ô∏è</span>
          <p>Unable to load document</p>
          <div class="fallback-actions">
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download Document
            </button>
          </div>
        </div>

        <!-- Smart Display: PDF Viewer (if blob is PDF) -->
        <div *ngIf="isPdfDocument && !imageLoading && !imageError" class="pdf-container">
          <div class="format-badge pdf-badge">
            üìÑ PDF Format
          </div>
          <object [data]="documentImageUrl"
                  type="application/pdf"
                  class="pdf-viewer">
            <div class="pdf-fallback">
              <p>‚ö†Ô∏è Your browser cannot display PDF files inline.</p>
              <p>Please use one of the options below:</p>
              <div class="fallback-actions">
                <button (click)="openPdfInNewTab()" class="btn-primary">
                  <span>üîó</span> Open PDF in New Tab
                </button>
                <button (click)="downloadDocument()" class="btn-download">
                  <span>‚¨áÔ∏è</span> Download PDF
                </button>
              </div>
            </div>
          </object>
          <div class="image-actions">
            <button (click)="openPdfInNewTab()" class="btn-primary">
              <span>üîó</span> Open in New Tab
            </button>
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download
            </button>
          </div>
        </div>

        <!-- Smart Display: Image Viewer (if blob is Image) -->
        <div *ngIf="isImageDocument && !imageLoading && !imageError" class="image-container">
          <div class="format-badge image-badge">
            üñºÔ∏è Image Format
          </div>
          <img [src]="documentImageRawUrl"
               [alt]="document.fileName"
               class="document-image"
               (error)="onImageError()">
          <div class="image-actions">
            <button (click)="downloadDocument()" class="btn-download">
              <span>‚¨áÔ∏è</span> Download Original
            </button>
          </div>
        </div>

        <!-- No Document Available -->
        <div *ngIf="!isPdfDocument && !isImageDocument && !imageLoading && !imageError" class="no-image">
          <span class="no-image-icon">üìÑ</span>
          <p>No preview available for this document type</p>
          <button (click)="downloadDocument()" class="btn-download">
            <span>‚¨áÔ∏è</span> Download Document
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Mode Actions -->
    <div *ngIf="editMode" class="edit-actions">
      <p class="required-note"><span class="required">*</span> Required fields</p>
      <div class="action-buttons">
        <button (click)="cancelEdit()" class="btn-secondary" [disabled]="saving">
          Cancel
        </button>
        <button (click)="saveManualEntry()" class="btn-primary" [disabled]="saving">
          <span *ngIf="!saving">üíæ Save Changes</span>
          <span *ngIf="saving">Saving...</span>
        </button>
      </div>
    </div>

    <!-- Document Preview (Optional - for future implementation) -->
    <!-- <div class="document-preview">
      <h3>Document Preview</h3>
      <img [src]="document.filePath" alt="Document preview" *ngIf="document.fileType?.startsWith('image/')">
      <p *ngIf="!document.fileType?.startsWith('image/')">Preview not available for this file type</p>
    </div> -->
  </div>
</div>

