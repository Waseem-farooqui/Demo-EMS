<div class="document-list-container">
  <div class="page-header">
    <h2>Documents</h2>
    <div class="header-actions">
      <button (click)="uploadNewDocument()" class="btn btn-primary">
        <span>üì§</span> Upload Document
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading documents...</div>

  <div *ngIf="error" class="error-message">{{ error }}</div>

  <div *ngIf="!loading && documents.length === 0 && totalElements === 0" class="no-data">
    No documents found. Click "Upload Document" to get started.
  </div>

  <!-- Main Content Layout: Table -->
  <div class="main-content-layout" *ngIf="!loading && (documents.length > 0 || totalElements > 0)">
    <!-- Table Content Area -->
    <div class="table-content-area">
      <!-- Global Search Filter -->
      <div class="global-search-container">
        <label for="globalSearch" class="global-search-label">Filter</label>
        <input
          type="text"
          id="globalSearch"
          class="global-search-input"
          placeholder="Search documents..."
          [(ngModel)]="globalSearchQuery"
          (input)="onGlobalSearchChange()"
        />
      </div>

      <!-- Document Type Filter Buttons -->
      <div class="filter-section">
        <button
          *ngFor="let filter of documentTypeFilters"
          class="filter-btn"
          [class.active]="filterType === filter.value"
          (click)="filterByType(filter.value)">
          {{ filter.label }}
        </button>
      </div>

      <!-- Expiry Filter Status -->
      <div *ngIf="expiryFilter !== 'all'" class="expiry-filter-banner">
        <span class="filter-icon">üîç</span>
        <span class="filter-text">{{ getExpiryFilterLabel() }}</span>
        <button class="clear-filter-btn" (click)="clearExpiryFilter()">
          ‚úï Clear Filter
        </button>
      </div>

      <div *ngIf="filteredDocuments.length === 0" class="no-results">
        <div class="no-results-icon">üîç</div>
        <p class="no-results-text">No documents match your search criteria</p>
        <button class="btn btn-secondary" (click)="clearFilters()">Clear Filters</button>
      </div>

      <table *ngIf="filteredDocuments.length > 0" class="document-table">
        <thead>
          <tr>
            <th (click)="onSort('employeeName')" class="sortable">
              <span>Employee Name</span>
              <span class="sort-icon">{{ getSortIcon('employeeName') }}</span>
            </th>
            <th (click)="onSort('documentType')" class="sortable">
              <span>Document Type</span>
              <span class="sort-icon">{{ getSortIcon('documentType') }}</span>
            </th>
            <th (click)="onSort('documentNumber')" class="sortable">
              <span>Document Number</span>
              <span class="sort-icon">{{ getSortIcon('documentNumber') }}</span>
            </th>
            <th (click)="onSort('expiryDate')" class="sortable">
              <span>Expiry Date</span>
              <span class="sort-icon">{{ getSortIcon('expiryDate') }}</span>
            </th>
            <th (click)="onSort('daysUntilExpiry')" class="sortable">
              <span>Status</span>
              <span class="sort-icon">{{ getSortIcon('daysUntilExpiry') }}</span>
            </th>
            <th (click)="onSort('uploadedDate')" class="sortable">
              <span>Uploaded Date</span>
              <span class="sort-icon">{{ getSortIcon('uploadedDate') }}</span>
            </th>
            <th (click)="onSort('lastViewedAt')" class="sortable">
              <span>Last Viewed</span>
              <span class="sort-icon">{{ getSortIcon('lastViewedAt') }}</span>
            </th>
            <th (click)="onSort('lastViewedBy')" class="sortable">
              <span>Viewed By</span>
              <span class="sort-icon">{{ getSortIcon('lastViewedBy') }}</span>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let doc of filteredDocuments">
            <td data-label="Employee Name">
              <div class="employee-name">
                <span class="name-icon">üë§</span>
                <strong>{{ doc.employeeName || '-' }}</strong>
              </div>
            </td>
            <td data-label="Document Type">
              <span class="doc-type-badge" 
                    [class.type-passport]="doc.documentType === 'PASSPORT'"
                    [class.type-visa]="doc.documentType === 'VISA'"
                    [class.type-contract]="doc.documentType === 'CONTRACT'"
                    [class.type-resume]="doc.documentType === 'RESUME'"
                    [class.type-share-code]="doc.documentType === 'SHARE_CODE'"
                    [class.type-professional-certificate]="doc.documentType === 'PROFESSIONAL_CERTIFICATE'"
                    [class.type-term-letter]="doc.documentType === 'TERM_LETTER'">
                {{ getDocumentTypeLabel(doc.documentType) }}
              </span>
            </td>
            <td data-label="Document Number">
              <span *ngIf="doc.documentNumber">{{ doc.documentNumber }}</span>
              <span *ngIf="!doc.documentNumber" class="no-data-cell">-</span>
            </td>
            <td data-label="Expiry Date">
              <span *ngIf="doc.expiryDate">{{ formatDate(doc.expiryDate) }}</span>
              <span *ngIf="!doc.expiryDate" class="no-data-cell">-</span>
            </td>
            <td data-label="Status">
              <div *ngIf="shouldShowExpiryBadge(doc)" 
                   class="expiry-badge"
                   [ngClass]="getExpiryStatus(doc.daysUntilExpiry)">
                {{ getExpiryStatusText(doc.daysUntilExpiry) }}
              </div>
              <span *ngIf="!shouldShowExpiryBadge(doc)" class="no-data-cell">-</span>
            </td>
            <td data-label="Uploaded Date">
              <span *ngIf="doc.uploadedDate">{{ formatDate(doc.uploadedDate) }}</span>
              <span *ngIf="!doc.uploadedDate" class="no-data-cell">-</span>
            </td>
            <td data-label="Last Viewed">
              <span *ngIf="doc.lastViewedAt" class="last-viewed-date">{{ formatDateTime(doc.lastViewedAt) }}</span>
              <span *ngIf="!doc.lastViewedAt" class="no-data-cell">Never</span>
            </td>
            <td data-label="Viewed By">
              <span *ngIf="doc.lastViewedBy" class="viewed-by-badge">{{ doc.lastViewedBy }}</span>
              <span *ngIf="!doc.lastViewedBy" class="no-data-cell">-</span>
            </td>
            <td class="actions" data-label="Actions">
              <button (click)="viewDetails(doc)" class="btn btn-details btn-sm" title="View Details">
                üëÅÔ∏è
              </button>
              <button (click)="deleteDocument(doc)" class="btn btn-delete btn-sm" title="Delete Document">
                üóëÔ∏è
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination Controls -->
      <div class="pagination-container" *ngIf="usePagination && totalElements > 0">
        <div class="pagination-left">
          <label for="itemsPerPage" class="pagination-label">Items per page:</label>
          <select 
            id="itemsPerPage"
            class="pagination-select" 
            [value]="pageSize" 
            (change)="onPageSizeChange(+$any($event.target).value)">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <span class="pagination-range">
            {{ (currentPage * pageSize) + 1 }} - {{ Math.min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }}
          </span>
        </div>
        
        <div class="pagination-right">
          <button 
            class="pagination-nav-btn"
            [disabled]="currentPage === 0"
            (click)="onPageChange(0)"
            title="First Page">
            |<
          </button>
          <button 
            class="pagination-nav-btn"
            [disabled]="currentPage === 0"
            (click)="onPageChange(currentPage - 1)"
            title="Previous Page">
            <
          </button>
          <button 
            *ngFor="let pageNum of pageNumbers"
            class="pagination-nav-btn"
            [class.active]="pageNum === currentPage"
            (click)="onPageChange(pageNum)">
            {{ pageNum + 1 }}
          </button>
          <button 
            class="pagination-nav-btn"
            [disabled]="currentPage >= totalPages - 1"
            (click)="onPageChange(currentPage + 1)"
            title="Next Page">
            >
          </button>
          <button 
            class="pagination-nav-btn"
            [disabled]="currentPage >= totalPages - 1"
            (click)="onPageChange(totalPages - 1)"
            title="Last Page">
            >|
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Document Details Modal -->
  <div *ngIf="selectedDocument" class="modal-overlay" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Document Details</h3>
        <button (click)="closeDetails()" class="btn-close">√ó</button>
      </div>

      <div class="modal-body">
        <div class="detail-section">
          <h4>Document Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Employee:</label>
              <span>{{ selectedDocument.employeeName }}</span>
            </div>
            <div class="detail-item">
              <label>Document Type:</label>
              <span class="badge-type">{{ getDocumentTypeLabel(selectedDocument.documentType) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.documentType !== 'CONTRACT' && selectedDocument.documentNumber">
              <label>Document Number:</label>
              <span class="highlight">{{ selectedDocument.documentNumber }}</span>
            </div>
            <!-- CONTRACT specific fields -->
            <div class="detail-item" *ngIf="selectedDocument.documentType === 'CONTRACT' && selectedDocument.contractDate">
              <label>üìÖ Contract Date:</label>
              <span class="highlight">{{ formatDate(selectedDocument.contractDate) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.documentType === 'CONTRACT' && selectedDocument.jobTitleContract">
              <label>üíº Job Title:</label>
              <span class="highlight">{{ selectedDocument.jobTitleContract }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.documentType === 'CONTRACT' && selectedDocument.placeOfWork">
              <label>üìç Place of Work:</label>
              <span class="highlight">{{ selectedDocument.placeOfWork }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.documentType === 'CONTRACT' && selectedDocument.contractBetween">
              <label>üìù Contract Between:</label>
              <span class="highlight">{{ selectedDocument.contractBetween }}</span>
            </div>
            <div class="detail-item">
              <label>File Name:</label>
              <span>{{ selectedDocument.fileName }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDocument.documentType !== 'CONTRACT' && (selectedDocument.issueDate || selectedDocument.expiryDate)">
          <h4>Important Dates</h4>
          <div class="detail-grid">
            <div class="detail-item" *ngIf="selectedDocument.issueDate">
              <label>Issue Date:</label>
              <span>{{ formatDate(selectedDocument.issueDate) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.expiryDate">
              <label>Expiry Date:</label>
              <span>{{ formatDate(selectedDocument.expiryDate) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.daysUntilExpiry !== undefined">
              <label>Days Until Expiry:</label>
              <span [ngClass]="getExpiryStatus(selectedDocument.daysUntilExpiry)">
                {{ selectedDocument.daysUntilExpiry }} days
              </span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedDocument.fullName || selectedDocument.dateOfBirth">
          <h4>Personal Information</h4>
          <div class="detail-grid">
            <div class="detail-item" *ngIf="selectedDocument.fullName">
              <label>Full Name:</label>
              <span>{{ selectedDocument.fullName }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.dateOfBirth">
              <label>Date of Birth:</label>
              <span>{{ formatDate(selectedDocument.dateOfBirth) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedDocument.documentType !== 'CONTRACT' && selectedDocument.issuingCountry">
              <label>Issuing Country:</label>
              <span>{{ selectedDocument.issuingCountry }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button (click)="deleteDocument(selectedDocument)" class="btn btn-danger">Delete Document</button>
        <button (click)="closeDetails()" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>
</div>
