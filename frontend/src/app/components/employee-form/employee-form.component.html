<div class="wizard-container">
  <div class="wizard-header">
    <h2>{{ isEditMode ? 'Edit Employee' : 'Create New Employee' }}</h2>
    <p class="wizard-subtitle">Step {{ currentStep }} of {{ totalSteps }}</p>
  </div>

  <!-- Progress Steps -->
  <div class="wizard-progress">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="(currentStep / totalSteps) * 100"></div>
    </div>
    <div class="steps-indicator">
      <div *ngFor="let step of steps" 
           class="step-indicator"
           [class.active]="currentStep === step.number"
           [class.completed]="currentStep > step.number"
           (click)="goToStep(step.number)">
        <span class="step-icon">{{ step.icon }}</span>
        <span class="step-title">{{ step.title }}</span>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <!-- Loading -->
  <div *ngIf="loading && isEditMode" class="loading">Loading employee data...</div>

  <!-- Wizard Form -->
  <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()" *ngIf="!loading || !isEditMode" class="wizard-form">
    
    <!-- Step 1: Personal Information (with Address) -->
    <div class="wizard-step" *ngIf="currentStep === 1">
      <div class="step-header">
        <h3>üë§ Personal Information</h3>
        <p>Enter basic personal details and address information</p>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="title">Title</label>
          <select id="title" formControlName="title" class="form-control">
            <option value="">Select Title</option>
            <option value="Mr">Mr</option>
            <option value="Mrs">Mrs</option>
            <option value="Miss">Miss</option>
            <option value="Ms">Ms</option>
            <option value="Dr">Dr</option>
            <option value="Prof">Prof</option>
          </select>
        </div>

        <div class="form-group">
          <label for="fullName">Full Name <span class="required">*</span></label>
          <input type="text" id="fullName" formControlName="fullName" 
                 [class.invalid]="isFieldInvalid('fullName')" 
                 placeholder="Enter full name">
          <div class="error" *ngIf="isFieldInvalid('fullName')">Full name is required.</div>
        </div>

        <div class="form-group">
          <label for="personType">Person Type <span class="required">*</span></label>
          <select id="personType" formControlName="personType" 
                  [class.invalid]="isFieldInvalid('personType')">
            <option value="">Select person type</option>
            <option value="Full-time">Full-time</option>
            <option value="Part-time">Part-time</option>
            <option value="Contractor">Contractor</option>
            <option value="Intern">Intern</option>
          </select>
          <div class="error" *ngIf="isFieldInvalid('personType')">Person type is required.</div>
        </div>

        <div class="form-group">
          <label for="workEmail">Work Email <span class="required">*</span></label>
          <input type="email" id="workEmail" formControlName="workEmail" 
                 [class.invalid]="isFieldInvalid('workEmail')" 
                 placeholder="user@company.com">
          <div class="error" *ngIf="isFieldInvalid('workEmail')">Valid work email is required.</div>
        </div>

        <div class="form-group">
          <label for="phoneNumber">Phone Number</label>
          <input type="tel" id="phoneNumber" formControlName="phoneNumber" 
                 placeholder="+44 20 1234 5678">
        </div>

        <div class="form-group">
          <label for="dateOfBirth">Date of Birth</label>
          <input type="date" id="dateOfBirth" formControlName="dateOfBirth" [max]="maxDate">
        </div>

        <div class="form-group">
          <label for="nationality">Nationality</label>
          <input type="text" id="nationality" formControlName="nationality" 
                 placeholder="e.g., British, American">
        </div>

        <!-- Address Information -->
        <div class="form-group full-width">
          <label for="presentAddress">Present Address</label>
          <textarea id="presentAddress" formControlName="presentAddress" rows="3" 
                    placeholder="Current residential address"></textarea>
        </div>

        <div class="form-group full-width">
          <label for="previousAddress">Previous Address</label>
          <textarea id="previousAddress" formControlName="previousAddress" rows="3" 
                    placeholder="Previous residential address"></textarea>
        </div>
      </div>
    </div>

    <!-- Step 2: Work Information -->
    <div class="wizard-step" *ngIf="currentStep === 2">
      <div class="step-header">
        <h3>üíº Work Information</h3>
        <p>Enter employment details</p>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="jobTitle">Position/Job Title</label>
          <input type="text" id="jobTitle" formControlName="jobTitle" 
                 placeholder="e.g., Software Developer, Manager">
        </div>

        <div class="form-group">
          <label for="reference">Employee ID/Reference</label>
          <input type="text" id="reference" formControlName="reference" 
                 placeholder="e.g., EMP001">
        </div>

        <div class="form-group">
          <label for="dateOfJoining">Date of Joining <span class="required">*</span></label>
          <input type="date" id="dateOfJoining" formControlName="dateOfJoining" 
                 [class.invalid]="isFieldInvalid('dateOfJoining')" [max]="maxDate">
          <div class="error" *ngIf="isFieldInvalid('dateOfJoining')">Date of joining is required.</div>
        </div>

        <div class="form-group">
          <label for="employmentStatus">Employment Status</label>
          <select id="employmentStatus" formControlName="employmentStatus">
            <option value="">Select status</option>
            <option value="FULL_TIME">Full Time</option>
            <option value="PART_TIME">Part Time</option>
            <option value="CONTRACT">Contract</option>
            <option value="TEMPORARY">Temporary</option>
          </select>
        </div>

        <div class="form-group">
          <label for="contractType">Contract Type</label>
          <select id="contractType" formControlName="contractType">
            <option value="">Select type</option>
            <option value="PERMANENT">Permanent</option>
            <option value="TEMPORARY">Temporary</option>
            <option value="FIXED_TERM">Fixed Term</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Step 3: Role & Department -->
    <div class="wizard-step" *ngIf="currentStep === 3">
      <div class="step-header">
        <h3>üè¢ Role & Department</h3>
        <p>Assign role, department, and position</p>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="departmentId">Department <span class="required">*</span></label>
          <select id="departmentId" formControlName="departmentId"
                  [class.invalid]="isFieldInvalid('departmentId')">
            <option [value]="null">Select Department</option>
            <option *ngFor="let dept of departments" [value]="dept.id">
              {{ dept.name }}
            </option>
          </select>
          <div class="error" *ngIf="isFieldInvalid('departmentId')">Department is required.</div>
        </div>

        <div class="form-group">
          <label for="position">Position</label>
          <select id="position" formControlName="jobTitle">
            <option value="">Select Position</option>
            <option *ngFor="let position of positions" [value]="position">
              {{ position }}
            </option>
          </select>
          <small class="form-hint">üí° Select a position or enter custom in Step 2</small>
        </div>

        <div class="form-group full-width">
          <label for="allottedOrganization">Allotted Organization</label>
          <input type="text" id="allottedOrganization" formControlName="allottedOrganization" 
                 placeholder="Enter organization name if employee is outsourced">
          <small class="form-hint">üí° For employees outsourced to other companies</small>
        </div>
      </div>

      <div class="form-section-header">
        <h4>Financial & Employment Details</h4>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="nationalInsuranceNumber">National Insurance Number</label>
          <input type="text" id="nationalInsuranceNumber" formControlName="nationalInsuranceNumber" 
                 placeholder="e.g., AB123456C">
        </div>

        <div class="form-group">
          <label for="shareCode">Share Code</label>
          <input type="text" id="shareCode" formControlName="shareCode" 
                 placeholder="e.g., ABC123">
        </div>

        <div class="form-group">
          <label for="wageRate">Wage Rate</label>
          <input type="text" id="wageRate" formControlName="wageRate" 
                 placeholder="e.g., ¬£15.50/hour or ¬£30,000/year">
        </div>

        <div class="form-group">
          <label for="contractHours">Contract Hours</label>
          <input type="text" id="contractHours" formControlName="contractHours" 
                 placeholder="e.g., 40 hours/week or Full-time">
        </div>
      </div>

      <div class="form-section-header">
        <h4>Bank Account Details</h4>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="bankAccountNumber">Account Number</label>
          <input type="text" id="bankAccountNumber" formControlName="bankAccountNumber" 
                 placeholder="Account number">
        </div>

        <div class="form-group">
          <label for="bankSortCode">Sort Code</label>
          <input type="text" id="bankSortCode" formControlName="bankSortCode" 
                 placeholder="e.g., 12-34-56">
        </div>

        <div class="form-group">
          <label for="bankAccountHolderName">Account Holder Name</label>
          <input type="text" id="bankAccountHolderName" formControlName="bankAccountHolderName" 
                 placeholder="Account holder name">
        </div>

        <div class="form-group">
          <label for="bankName">Bank Name</label>
          <input type="text" id="bankName" formControlName="bankName" 
                 placeholder="Bank name">
        </div>
      </div>
    </div>

    <!-- Step 4: Next of Kin -->
    <div class="wizard-step" *ngIf="currentStep === 4">
      <div class="step-header">
        <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Next of Kin</h3>
        <p>Add next of kin contact information (Optional)</p>
      </div>
      <div class="section-header">
        <h4>Next of Kin Contacts</h4>
        <button type="button" class="btn-add-record" (click)="addNextOfKin()">
          ‚ûï Add Next of Kin
        </button>
      </div>

      <div formArrayName="nextOfKinList" class="next-of-kin-records">
        <div *ngFor="let kinGroup of nextOfKinList.controls; let i = index" 
             [formGroupName]="i" 
             class="next-of-kin-record-card">
          <div class="record-header">
            <h4>Next of Kin {{ i + 1 }}</h4>
            <button type="button" class="btn-remove" (click)="removeNextOfKin(i)" 
                    *ngIf="nextOfKinList.length > 1">Remove</button>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label [for]="'nextOfKinTitle-' + i">Title</label>
              <select [id]="'nextOfKinTitle-' + i" class="form-control" formControlName="title">
                <option value="">Select Title</option>
                <option value="Mr">Mr</option>
                <option value="Mrs">Mrs</option>
                <option value="Miss">Miss</option>
                <option value="Ms">Ms</option>
                <option value="Dr">Dr</option>
                <option value="Prof">Prof</option>
              </select>
            </div>

            <div class="form-group">
              <label [for]="'nextOfKinName-' + i">Name</label>
              <input type="text" [id]="'nextOfKinName-' + i" formControlName="name" 
                     placeholder="Full name">
            </div>

            <div class="form-group">
              <label [for]="'nextOfKinContact-' + i">Contact Number</label>
              <input type="tel" [id]="'nextOfKinContact-' + i" formControlName="contact" 
                     placeholder="+44 20 1234 5678">
            </div>

            <div class="form-group full-width">
              <label [for]="'nextOfKinRelationship-' + i">Relationship</label>
              <input type="text" [id]="'nextOfKinRelationship-' + i" formControlName="relationship" 
                     placeholder="e.g., Spouse, Parent, Sibling">
            </div>

            <div class="form-group full-width">
              <label [for]="'nextOfKinAddress-' + i">Address</label>
              <textarea [id]="'nextOfKinAddress-' + i" formControlName="address" rows="3" 
                        placeholder="Full address"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 5: Previous Employment -->
    <div class="wizard-step" *ngIf="currentStep === 5">
      <div class="step-header">
        <h3>üìã Previous Employment</h3>
        <p>Employment history (Optional)</p>
      </div>

      <div formArrayName="employmentRecords" class="employment-records">
        <div *ngFor="let record of employmentRecords.controls; let i = index" 
             [formGroupName]="i" 
             class="employment-record-card">
          <div class="record-header">
            <h4>Employment Record {{ i + 1 }}</h4>
            <button type="button" class="btn-remove" (click)="removeEmploymentRecord(i)" 
                    *ngIf="employmentRecords.length > 1">Remove</button>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Job Title</label>
              <input type="text" formControlName="jobTitle" placeholder="Previous job title">
            </div>

            <div class="form-group">
              <label>Employment Period</label>
              <input type="text" formControlName="employmentPeriod" 
                     placeholder="e.g., Jan 2020 - Dec 2022">
            </div>

            <div class="form-group">
              <label>Employer Name</label>
              <input type="text" formControlName="employerName" placeholder="Company name">
            </div>

            <div class="form-group full-width">
              <label>Employer Address</label>
              <textarea formControlName="employerAddress" rows="2" 
                        placeholder="Company address"></textarea>
            </div>

            <div class="form-group">
              <label>Contact Person Title</label>
              <select formControlName="contactPersonTitle">
                <option value="">Select Title</option>
                <option value="Mr">Mr</option>
                <option value="Mrs">Mrs</option>
                <option value="Miss">Miss</option>
                <option value="Ms">Ms</option>
                <option value="Dr">Dr</option>
                <option value="Prof">Prof</option>
              </select>
            </div>

            <div class="form-group">
              <label>Contact Person Name</label>
              <input type="text" formControlName="contactPersonName" 
                     class="form-control" placeholder="Contact person full name">
            </div>

            <div class="form-group">
              <label>Contact Person Email</label>
              <input type="email" formControlName="contactPersonEmail" 
                     placeholder="contact@company.com">
            </div>

            <div class="form-group">
              <label>Contact Person Phone</label>
              <input type="tel" formControlName="contactPersonPhone" 
                     placeholder="+44 123 456 7890">
            </div>
          </div>
        </div>

        <button type="button" class="btn-add-record" (click)="addEmploymentRecord()">
          ‚ûï Add Another Employment Record
        </button>
      </div>
    </div>

    <!-- Step 6: Medical Information -->
    <div class="wizard-step" *ngIf="currentStep === 6">
      <div class="step-header">
        <h3>ü©∫ Medical Information</h3>
        <p>Health and medical details (Optional)</p>
      </div>

      <div class="form-grid">
        <div class="form-group full-width checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="hasMedicalCondition">
            Employee has a medical condition
          </label>
        </div>

        <div class="form-group full-width" *ngIf="shouldShowMedicalDetails()">
          <label for="medicalConditionDetails">Condition Description <span class="required">*</span></label>
          <textarea id="medicalConditionDetails" formControlName="medicalConditionDetails" 
                    rows="4" placeholder="Provide relevant medical details"
                    [class.invalid]="isFieldInvalid('medicalConditionDetails')"></textarea>
          <div class="error" *ngIf="isFieldInvalid('medicalConditionDetails')">
            Medical condition description is required when condition is selected.
          </div>
        </div>
      </div>
    </div>

    <!-- Step 7: Documents -->
    <div class="wizard-step" *ngIf="currentStep === 7">
      <div class="step-header">
        <h3>üìÑ Documents & Comments</h3>
        <p>Upload employee documents and add comments (Optional)</p>
      </div>

      <!-- Comments Section -->
      <div class="form-section-header">
        <h4>üí¨ Comments & Notes</h4>
      </div>
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="comments">Additional Comments</label>
          <textarea id="comments" formControlName="comments" rows="5" 
                    placeholder="Add any additional notes, comments, or observations about this employee..."></textarea>
          <small class="form-hint">üí° This information will be visible in the employee detail view</small>
        </div>
      </div>

      <div class="form-section-header" style="margin-top: 2rem;">
        <h4>üìÑ Document Upload</h4>
      </div>
      <div class="document-upload-section">
        <div class="document-upload-grid">
          <div class="document-upload-item" *ngFor="let docType of documentTypes">
            <label class="document-label">{{ docType.replace('_', ' ') }}</label>
            <input type="file" 
                   (change)="onDocumentSelected($event, docType)"
                   accept="image/*,.pdf"
                   class="document-input">
          </div>
        </div>

        <div class="uploaded-documents" *ngIf="selectedDocuments.length > 0">
          <h4>Selected Documents:</h4>
          <div class="document-list">
            <div *ngFor="let doc of selectedDocuments; let i = index" class="document-item">
              <span class="doc-name">{{ doc.name }}</span>
              <span class="doc-type">({{ documentTypeMap[doc.name] }})</span>
              <button type="button" class="btn-remove-doc" (click)="removeDocument(i)">‚úï</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Wizard Navigation -->
    <div class="wizard-navigation">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancel</button>
      
      <div class="nav-buttons">
        <button type="button" class="btn btn-secondary" 
                (click)="previousStep()" 
                *ngIf="currentStep > 1">
          ‚Üê Previous
        </button>

        <button type="button" class="btn btn-skip" 
                (click)="skipStep()" 
                *ngIf="canSkipStep() && currentStep < totalSteps">
          Skip ‚Üí
        </button>

        <button type="button" class="btn btn-primary" 
                (click)="nextStep()" 
                *ngIf="currentStep < totalSteps">
          Next ‚Üí
        </button>

        <button type="submit" class="btn btn-primary" 
                *ngIf="currentStep === totalSteps"
                [disabled]="loading">
          {{ loading ? 'Saving...' : (isEditMode ? 'Update Employee' : 'Create Employee') }}
        </button>
        <div *ngIf="currentStep === totalSteps && employeeForm.invalid && employeeForm.touched" class="form-validation-hint" style="margin-top: 0.5rem;">
          <small class="text-danger">‚ö†Ô∏è Please complete all required fields before submitting.</small>
        </div>
      </div>
    </div>
  </form>
</div>
