<div class="alert-config-container">
  <div class="page-header">
    <div class="header-content">
      <h1>üìß Document Expiry Alert Configuration</h1>
      <p class="subtitle">Configure when to send expiry alerts for different document types</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="testAlerts()" [disabled]="testingAlerts">
        <span *ngIf="!testingAlerts">üß™ Test Alerts Now</span>
        <span *ngIf="testingAlerts">‚è≥ Testing...</span>
      </button>
      <button class="btn btn-primary" (click)="openAddForm()" *ngIf="!showAddForm">
        ‚ûï Add Configuration
      </button>
    </div>
  </div>

  <!-- Add/Edit Form -->
  <div class="config-form" *ngIf="showAddForm">
    <div class="form-header">
      <h3>‚ûï Add New Alert Configuration</h3>
      <button class="btn-close" (click)="closeAddForm()">‚úï</button>
    </div>
    <form (ngSubmit)="saveConfiguration()">
      <div class="form-row">
        <div class="form-group">
          <label for="documentType">Document Type *</label>
          <select
            id="documentType"
            [(ngModel)]="newConfig.documentType"
            name="documentType"
            class="form-control"
            required>
            <option value="">Select Document Type</option>
            <option *ngFor="let type of documentTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="alertPriority">Alert Priority *</label>
          <select
            id="alertPriority"
            [(ngModel)]="newConfig.alertPriority"
            name="alertPriority"
            class="form-control"
            required>
            <option value="">Select Priority</option>
            <option *ngFor="let priority of alertPriorities" [value]="priority.value">
              {{ priority.label }} ({{ priority.days }} days)
            </option>
          </select>
          <small class="form-text">Priority level determines alert urgency</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="alertDaysBefore">Alert Days Before Expiry *</label>
          <input
            type="number"
            id="alertDaysBefore"
            [(ngModel)]="newConfig.alertDaysBefore"
            name="alertDaysBefore"
            class="form-control"
            min="0"
            max="365"
            required>
          <small class="form-text">Number of days before expiry (0-365)</small>
        </div>

        <div class="form-group">
          <label for="notificationType">Notification Type *</label>
          <select
            id="notificationType"
            [(ngModel)]="newConfig.notificationType"
            name="notificationType"
            class="form-control"
            required>
            <option value="">Select Type</option>
            <option *ngFor="let type of notificationTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
          <small class="form-text">How should alerts be delivered</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="alertEmail">Alert Email *</label>
          <input
            type="email"
            id="alertEmail"
            [(ngModel)]="newConfig.alertEmail"
            name="alertEmail"
            class="form-control"
            placeholder="admin@company.com"
            required>
          <small class="form-text">Email address to receive expiry alerts</small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="newConfig.enabled"
              name="enabled">
            <span>Enabled</span>
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeAddForm()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="loading">
          <span *ngIf="!loading">üíæ Save Configuration</span>
          <span *ngIf="loading">‚è≥ Saving...</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading && !showAddForm && !editingConfig">
    <div class="spinner"></div>
    <p>Loading configurations...</p>
  </div>

  <!-- Configurations List -->
  <div class="configurations-grid" *ngIf="!loading || editingConfig">
    <div class="config-card" *ngFor="let config of configurations">
      <!-- View Mode -->
      <div class="card-content" *ngIf="editingConfig?.id !== config.id">
        <div class="card-header">
          <div class="doc-type">
            <span class="doc-icon">üìÑ</span>
            <h3>{{ getDocumentTypeLabel(config.documentType) }}</h3>
          </div>
          <div class="status-badge" [ngClass]="getStatusClass(config)">
            {{ getAlertStatus(config) }}
          </div>
        </div>

        <div class="card-body">
          <div class="info-row">
            <span class="label">Priority:</span>
            <span class="value priority-badge" [ngClass]="'priority-' + config.alertPriority.toLowerCase()">
              {{ getPriorityLabel(config.alertPriority) }}
            </span>
          </div>
          <div class="info-row">
            <span class="label">Alert Before:</span>
            <span class="value">{{ config.alertDaysBefore }} days</span>
          </div>
          <div class="info-row">
            <span class="label">Notification:</span>
            <span class="value">{{ getNotificationTypeLabel(config.notificationType) }}</span>
          </div>
          <div class="info-row">
            <span class="label">Alert Email:</span>
            <span class="value email-text">{{ config.alertEmail }}</span>
          </div>
          <div class="info-row">
            <span class="label">Status:</span>
            <span class="value">
              <span class="toggle-badge" [class.active]="config.enabled">
                {{ config.enabled ? '‚úÖ Enabled' : '‚ùå Disabled' }}
              </span>
            </span>
          </div>
        </div>

        <div class="card-actions">
          <button class="btn btn-sm btn-secondary" (click)="editConfiguration(config)">
            ‚úèÔ∏è Edit
          </button>
          <button
            class="btn btn-sm"
            [class.btn-success]="!config.enabled"
            [class.btn-warning]="config.enabled"
            (click)="toggleEnabled(config)">
            {{ config.enabled ? 'üîï Disable' : 'üîî Enable' }}
          </button>
        </div>
      </div>

      <!-- Edit Mode -->
      <div class="card-content editing" *ngIf="editingConfig?.id === config.id">
        <div class="card-header">
          <h3>‚úèÔ∏è Edit Configuration</h3>
          <button class="btn-close-small" (click)="cancelEdit()">‚úï</button>
        </div>

        <form (ngSubmit)="updateConfiguration()">
          <div class="form-group">
            <label>Document Type</label>
            <input
              type="text"
              class="form-control"
              [value]="getDocumentTypeLabel(editingConfig!.documentType)"
              disabled>
          </div>

          <div class="form-group">
            <label for="editPriority">Alert Priority *</label>
            <select
              id="editPriority"
              [(ngModel)]="editingConfig!.alertPriority"
              name="editPriority"
              class="form-control"
              required>
              <option *ngFor="let priority of alertPriorities" [value]="priority.value">
                {{ priority.label }} ({{ priority.days }} days)
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="editAlertDays">Alert Days Before Expiry *</label>
            <input
              type="number"
              id="editAlertDays"
              [(ngModel)]="editingConfig!.alertDaysBefore"
              name="editAlertDays"
              class="form-control"
              min="0"
              max="365"
              required>
          </div>

          <div class="form-group">
            <label for="editNotificationType">Notification Type *</label>
            <select
              id="editNotificationType"
              [(ngModel)]="editingConfig!.notificationType"
              name="editNotificationType"
              class="form-control"
              required>
              <option *ngFor="let type of notificationTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="editEmail">Alert Email *</label>
            <input
              type="email"
              id="editEmail"
              [(ngModel)]="editingConfig!.alertEmail"
              name="editEmail"
              class="form-control"
              required>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="editingConfig!.enabled"
                name="editEnabled">
              <span>Enabled</span>
            </label>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-sm btn-secondary" (click)="cancelEdit()">
              Cancel
            </button>
            <button type="submit" class="btn btn-sm btn-primary" [disabled]="loading">
              <span *ngIf="!loading">üíæ Update</span>
              <span *ngIf="loading">‚è≥ Updating...</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="configurations.length === 0 && !loading">
      <div class="empty-icon">üì≠</div>
      <h3>No Alert Configurations</h3>
      <p>Add your first alert configuration to start monitoring document expiry</p>
      <button class="btn btn-primary" (click)="openAddForm()">
        ‚ûï Add First Configuration
      </button>
    </div>
  </div>

  <!-- Info Panel -->
  <div class="info-panel">
    <h4>‚ÑπÔ∏è How It Works</h4>
    <ul>
      <li><strong>Priority Levels:</strong> Set different priorities for same document type</li>
      <li><strong>Multiple Alerts:</strong> Create multiple alerts per document (e.g., 90, 30, 7 days)</li>
      <li><strong>Notification Types:</strong> Choose Email, In-App, or Both</li>
      <li><strong>Alert Days Before:</strong> Number of days before expiry to send notification</li>
      <li><strong>Automatic Check:</strong> System checks daily at midnight</li>
      <li><strong>Test Alerts:</strong> Use "Test Alerts Now" to check immediately</li>
    </ul>

    <div class="alert-examples">
      <h5>üí° Recommended Configuration</h5>
      <div class="example-item">
        <span class="example-type">üî¥ Expired (0 days):</span>
        <span class="example-value">Immediate action</span>
      </div>
      <div class="example-item">
        <span class="example-type">üü† Critical (7 days):</span>
        <span class="example-value">Urgent renewal</span>
      </div>
      <div class="example-item">
        <span class="example-type">üü° Warning (30 days):</span>
        <span class="example-value">Start processing</span>
      </div>
      <div class="example-item">
        <span class="example-type">üîµ Attention (90 days):</span>
        <span class="example-value">Early planning</span>
      </div>
    </div>

    <div class="alert-examples" style="margin-top: 20px;">
      <h5>üìß Notification Types</h5>
      <div class="example-item">
        <span class="example-type">üìß Email Only:</span>
        <span class="example-value">Send to email address</span>
      </div>
      <div class="example-item">
        <span class="example-type">üîî In-App Only:</span>
        <span class="example-value">Dashboard notification</span>
      </div>
      <div class="example-item">
        <span class="example-type">üìßüîî Both:</span>
        <span class="example-value">Email + In-App</span>
      </div>
    </div>
  </div>
</div>

