<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>ðŸ“§ Configure Email Settings</h2>
      <button class="modal-close" (click)="closeModal()" *ngIf="showSkipOption">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="welcome-message">
        <p><strong>Welcome to Employee Management System!</strong></p>
        <p>To send emails to your employees, please configure your SMTP email settings.</p>
        <p class="info-text">You can skip this step and use default settings, or configure it later from Settings.</p>
      </div>

      <form [formGroup]="smtpForm" (ngSubmit)="onSubmit()">
        <!-- Provider Selection -->
        <div class="form-group">
          <label for="provider">Email Provider <span class="required">*</span></label>
          <select id="provider" formControlName="provider" class="form-control">
            <option value="GMAIL">Gmail</option>
            <option value="OUTLOOK">Outlook / Office 365</option>
            <option value="CUSTOM">Custom SMTP Server</option>
          </select>
        </div>

        <!-- Instructions Toggle -->
        <div class="instructions-toggle">
          <button type="button" class="btn btn-link" (click)="toggleInstructions()">
            {{ showInstructions ? 'â–¼' : 'â–¶' }} How to Generate App Password / Token
          </button>
        </div>

        <!-- Instructions Panel -->
        <div class="instructions-panel" *ngIf="showInstructions">
          <div class="instruction-tabs">
            <button
              type="button"
              class="tab-btn"
              [class.active]="selectedProvider === 'GMAIL'"
              (click)="selectedProvider = 'GMAIL'; smtpForm.patchValue({provider: 'GMAIL'})">
              Gmail
            </button>
            <button
              type="button"
              class="tab-btn"
              [class.active]="selectedProvider === 'OUTLOOK'"
              (click)="selectedProvider = 'OUTLOOK'; smtpForm.patchValue({provider: 'OUTLOOK'})">
              Outlook
            </button>
          </div>

          <div class="instruction-content" *ngIf="selectedProvider === 'GMAIL'">
            <h4>ðŸ“§ Gmail App Password Setup</h4>
            <ol>
              <li>Go to your <a href="https://myaccount.google.com/" target="_blank">Google Account</a></li>
              <li>Click on <strong>Security</strong> in the left navigation</li>
              <li>Enable <strong>2-Step Verification</strong> (if not already enabled)</li>
              <li>Go to <strong>App passwords</strong> under "Signing in to Google"</li>
              <li>Select <strong>Mail</strong> and <strong>Other (Custom name)</strong></li>
              <li>Enter "Employee Management System" as the name</li>
              <li>Click <strong>Generate</strong> and copy the 16-character password</li>
              <li>Paste it in the "Password" field below (remove spaces)</li>
            </ol>
            <div class="note">
              <strong>Note:</strong> You must use an App Password, not your regular Gmail password.
            </div>
          </div>

          <div class="instruction-content" *ngIf="selectedProvider === 'OUTLOOK'">
            <h4>ðŸ“§ Outlook App Password Setup</h4>
            <ol>
              <li>Go to <a href="https://account.microsoft.com/security" target="_blank">Microsoft Account Security</a></li>
              <li>Click on <strong>Advanced security options</strong></li>
              <li>Under "App passwords", click <strong>Create a new app password</strong></li>
              <li>Enter "Employee Management System" as the app name</li>
              <li>Click <strong>Generate</strong> and copy the password</li>
              <li>Paste it in the "Password" field below</li>
            </ol>
            <div class="note">
              <strong>Note:</strong> For Office 365 business accounts, contact your IT administrator.
            </div>
          </div>
        </div>

        <!-- SMTP Fields -->
        <div class="form-row">
          <div class="form-group">
            <label for="host">SMTP Host <span class="required">*</span></label>
            <input
              type="text"
              id="host"
              formControlName="host"
              class="form-control"
              [readonly]="selectedProvider !== 'CUSTOM'">
          </div>

          <div class="form-group">
            <label for="port">SMTP Port <span class="required">*</span></label>
            <input
              type="number"
              id="port"
              formControlName="port"
              class="form-control"
              [readonly]="selectedProvider !== 'CUSTOM'">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="username">Email Address <span class="required">*</span></label>
            <input
              type="email"
              id="username"
              formControlName="username"
              class="form-control"
              placeholder="your-email@gmail.com">
          </div>

          <div class="form-group">
            <label for="password">App Password <span class="required">*</span></label>
            <input
              type="password"
              id="password"
              formControlName="password"
              class="form-control"
              placeholder="Enter app password">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fromEmail">From Email <span class="required">*</span></label>
            <input
              type="email"
              id="fromEmail"
              formControlName="fromEmail"
              class="form-control"
              placeholder="noreply@yourcompany.com">
          </div>

          <div class="form-group">
            <label for="fromName">From Name</label>
            <input
              type="text"
              id="fromName"
              formControlName="fromName"
              class="form-control"
              placeholder="Employee Management System">
          </div>
        </div>

        <!-- Form Actions -->
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="skipConfiguration()" [disabled]="saving">
            Skip for Now
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="saving || smtpForm.invalid">
            <span *ngIf="!saving">ðŸ’¾ Save & Continue</span>
            <span *ngIf="saving">Saving...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

